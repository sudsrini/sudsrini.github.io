<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <script src="/assets/js/main.js" defer></script>

    
    <title>Sudarsan Srinivasan's Portfolio</title>
    

</head>
<body>
    <!-- NAVBAR -->
     <nav class="navbar">
    <div class="nav-left">
        <a href="/">Sudarsan Srinivasan</a>
    </div>

    <div class="nav-right">
        <div class="desktop-nav">
            <a href="/">
                <span>Home</span>
            </a>
            <a href="/about.html">
                <span>About</span>
            </a>
            
                <a href="/experience">
                    <span>Experience</span>
                </a>
                <a href="/projects/">
                    <span>Projects</span>
                </a>
            
            <a href="/assets/resume/SudarsanSrinivasan_Resume.pdf" target="_blank" rel="noopener noreferrer">
                <span>Resume</span>
            </a>
        </div>

        <!-- Desktop Theme Toggle -->
        <div class="theme-toggle-container desktop-toggle">
            <span class="toggle-label">Toggle Theme</span>
            <label class="switch">
                <input type="checkbox" id="theme-toggle">
                <span class="slider round"></span>
            </label>
        </div>

        <!-- Mobile Menu Button -->
        <button class="menu-toggle" aria-label="Toggle menu">
            <i class="fa fa-bars fa-2x"></i>
        </button>

        <div class="mobile-nav">
            <a href="/">
                <span>Home</span>
            </a>
            <a href="/about.html">
                <span>About</span>
            </a>
            
                <a href="/#experience">
                    <span>Experience</span>
                </a>
                <a href="/projects/">
                    <span>Projects</span>
                </a>
            
            <a href="/assets/resume/SudarsanSrinivasan_Resume.pdf" target="_blank" rel="noopener noreferrer">
                <span>Resume</span>
            </a>

            <!-- Mobile Theme Toggle -->
            <div class="theme-toggle-container mobile-toggle">
                <span class="toggle-label">Toggle Theme</span>
                <label class="switch">
                    <input type="checkbox" id="theme-toggle-mobile">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>
    </div>
</nav>


     <div class="page"><div class="post-view">
    <div class="summary">
        
       
        <img src="/projects/safe-robot-arm/safe.jpg" alt="Safe End-Effector Trajectory Tracking for a 2-DOF Robotic Arm using CLF-CBF QP - Technical Report image">
        
        <div class="title-header">
            <h1>Safe End-Effector Trajectory Tracking for a 2-DOF Robotic Arm using CLF-CBF QP - Technical Report</h1>
        </div>
        
        <div class="project-description">
            <h2>Summary</h2>
            <p>This project investigates the application of Control Lyapunov Functions (CLFs) and Control Barrier Functions (CBFs) to ensure both performance and safety in robotic control. We implemented a CLF-CBF QP controller for a 2-DOF robotic arm that guarantees safe trajectory tracking while avoiding obstacles in its workspace.</p>
        </div>
        <div class="skills-card">
            <h2>Skills Used</h2> 
            <div class="skills-list">
                
                <span class="skill">Python</span>    
                
                <span class="skill">Control Lyapunov Function</span>    
                
                <span class="skill">Control Barrier Function</span>    
                
            </div>
        </div>
    </div>
      
    <div class="content">
        <h2 id="1-introduction-and-motivation">1. Introduction and Motivation</h2>
<h3 id="11-project-background">1.1 Project Background</h3>
<p>Robotic systems are increasingly being deployed in dynamic environments where they must operate safely while achieving their objectives. This project focuses on developing a control system that ensures both performance and safety in robotic control.</p>

<h3 id="12-why-this-matters">1.2 Why This Matters</h3>
<ul>
  <li><strong>Safety-Critical Applications</strong>: From industrial robots to autonomous vehicles, ensuring safe operation is paramount</li>
  <li><strong>Real-time Control</strong>: The need for computationally efficient methods that can run in real-time</li>
  <li><strong>Guaranteed Performance</strong>: Mathematical guarantees for both tracking performance and safety constraints</li>
</ul>

<h3 id="13-potential-impact">1.3 Potential Impact</h3>
<ul>
  <li><strong>Industrial Automation</strong>: Safe human-robot collaboration in manufacturing</li>
  <li><strong>Autonomous Systems</strong>: Safe navigation in dynamic environments</li>
  <li><strong>Medical Robotics</strong>: Ensuring patient safety during robotic procedures</li>
</ul>

<h2 id="2-theoretical-background-clf-and-cbf">2. Theoretical Background: CLF and CBF</h2>

<p>Control certificate functions are scalar functions used to certify certain properties of a dynamical system under control, such as stability and safety. Two key types are:</p>

<h3 id="control-lyapunov-functions-clf">Control Lyapunov Functions (CLF)</h3>
<p>A <strong>Control Lyapunov Function</strong> is used to certify the stabilizability of a system. For a nonlinear system $\dot{x} = f(x, u)$, a function $V(x)$ is a CLF if:</p>
<ul>
  <li>$V(x) &gt; 0$ for all $x \neq x^<em>$ (the equilibrium), and $V(x^</em>) = 0$</li>
  <li>There exists a control input $u$ such that the time derivative $\dot{V}(x, u) &lt; 0$ for all $x \neq x^*$</li>
</ul>

<p>This ensures that the system can be driven towards the equilibrium, certifying stability. The CLF condition can be enforced as a constraint in an optimization-based controller.</p>

<h3 id="control-barrier-functions-cbf">Control Barrier Functions (CBF)</h3>
<p>A <strong>Control Barrier Function</strong> is used to certify safety. Given a safe set $\mathcal{S} = { x \mid b(x) \geq 0 }$, a function $b(x)$ is a CBF for the system $\dot{x} = f(x, u)$ if there exists a class $\mathcal{K}$ function $\alpha$ such that:
\(\max_{u \in \mathcal{U}} \nabla b(x)^T f(x, u) \geq -\alpha(b(x)), \quad \forall x \in \mathcal{S}\)
This condition ensures that, for all states in the safe set, there exists a control input that keeps the system within the safe set for all future time. The CBF constraint can also be enforced in an optimization-based controller.</p>

<h3 id="combining-clf-and-cbf">Combining CLF and CBF</h3>
<p>For control affine systems, both CLF and CBF constraints can be combined in a quadratic program (QP), allowing the controller to balance stability (performance) and safety at each timestep. This approach is convex and can be solved efficiently.</p>

<p><em>Reference: <a href="https://uw-ctrl.github.io/lmc-book/lectures/control-certificates.html">UW-CTRL Linear Multivariable Control Book, Control Certificate Functions</a></em></p>

<h2 id="3-related-work">3. Related Work</h2>
<h3 id="31-traditional-approaches">3.1 Traditional Approaches</h3>
<ul>
  <li><strong>Potential Field Methods</strong>: Simple but can get stuck in local minima</li>
  <li><strong>RRT/PRM</strong>: Good for path planning but computationally expensive</li>
  <li><strong>MPC</strong>: Effective but requires solving optimization problems at each step</li>
</ul>

<h3 id="32-modern-methods">3.2 Modern Methods</h3>
<ul>
  <li><strong>CLF-CBF QP</strong>: Combines performance guarantees with safety constraints</li>
  <li><strong>Learning-based Methods</strong>: Neural networks for control but lack guarantees</li>
  <li><strong>Hybrid Methods</strong>: Combining classical and learning approaches</li>
</ul>

<h2 id="4-problem-statement">4. Problem Statement</h2>
<p>We consider a 2-DOF robotic manipulator that must:</p>
<ol>
  <li>Track a desired trajectory while</li>
  <li>Avoiding obstacles in its workspace</li>
</ol>

<h3 id="41-mathematical-formulation">4.1 Mathematical Formulation</h3>
<h4 id="system-dynamics">System Dynamics</h4>
<p>\(\dot{q} = u\)
where $q$ is the joint angle vector and $u$ is the control input.</p>

<h4 id="control-objectives">Control Objectives</h4>
<ol>
  <li><strong>Tracking</strong>: Minimize error between current and desired joint angles</li>
  <li><strong>Safety</strong>: Maintain minimum distance from obstacles</li>
</ol>

<h2 id="5-methodology">5. Methodology</h2>
<h3 id="51-step-by-step-implementation">5.1 Step-by-Step Implementation</h3>

<h4 id="1-forward-kinematics">1. Forward Kinematics</h4>
<p>Given joint angles q1, q2 and link lengths l1, l2:</p>
<ul>
  <li><strong>Elbow position:</strong>
\(x_1 = l_1 \cos(q_1), \quad y_1 = l_1 \sin(q_1)\)</li>
  <li><strong>End-effector position:</strong>
\(x_2 = x_1 + l_2 \cos(q_1 + q_2), \quad y_2 = y_1 + l_2 \sin(q_1 + q_2)\)</li>
</ul>

<h4 id="2-inverse-kinematics">2. Inverse Kinematics</h4>
<p>Given a desired end-effector position $(x_d, y_d)$:</p>
<ul>
  <li>Compute:
\(\cos(q_2^d) = \frac{x_d^2 + y_d^2 - l_1^2 - l_2^2}{2 l_1 l_2}\)
\(q_2^d = \arccos(\cos(q_2^d))\)
\(k_1 = l_1 + l_2 \cos(q_2^d), \quad k_2 = l_2 \sin(q_2^d)\)
\(q_1^d = \arctan2(y_d, x_d) - \arctan2(k_2, k_1)\)</li>
</ul>

<h4 id="3-error-calculation">3. Error Calculation</h4>
<ul>
  <li>$e = q - q_d$</li>
  <li>CLF: $V = e^T e$, $dV/de = 2e$</li>
</ul>

<h4 id="4-clf-and-cbf-constraints">4. CLF and CBF Constraints</h4>
<ul>
  <li>
    <p><strong>CLF constraint:</strong><br />
\(2e^T u + c_{clf} V \leq \delta\)
($\delta$ is a relaxation variable, penalized in the cost)</p>
  </li>
  <li>
    <p><strong>CBF constraint:</strong><br />
For each sampled point $p$ on the robot and each obstacle:
\(h(p) = \|p - p_{obs}\|^2 - (r_{obs} + b)^2\)
\(\dot{h}(p) = 2 (p - p_{obs})^T J_p u\)
\(2 (p - p_{obs})^T J_p u + \alpha_{cbf} h(p) \geq 0\)</p>
  </li>
</ul>

<h4 id="5-qp-setup">5. QP Setup</h4>
<ul>
  <li><strong>Variables:</strong> $u$ (joint velocities), $\delta$</li>
  <li><strong>Objective:</strong>
\(\min \|u\|^2 + \text{relax penalty} \cdot \delta^2 + \text{smooth weight} \cdot \|u - u_{prev}\|^2\)</li>
  <li><strong>Constraints:</strong>
    <ul>
      <li>CLF constraint</li>
      <li>CBF constraints (for all sampled points and obstacles)</li>
      <li>Velocity limits: $u_{min} \leq u \leq u_{max}$</li>
    </ul>
  </li>
</ul>

<h3 id="52-implementation-details">5.2 Implementation Details</h3>
<ul>
  <li><strong>Sampling</strong>: Multiple points along robot links</li>
  <li><strong>Jacobian Computation</strong>: Analytical for efficiency</li>
  <li><strong>QP Solver</strong>: OSQP for real-time performance</li>
</ul>

<h2 id="6-experiments-and-results">6. Experiments and Results</h2>
<h3 id="61-experimental-setup">6.1 Experimental Setup</h3>
<ul>
  <li><strong>Robot Parameters</strong>:
    <ul>
      <li>Link lengths: $l_1 = l_2 = 1.0$</li>
      <li>Joint limits: $[-2\pi, 2\pi]$</li>
      <li>Velocity limits: $[-1, 1]$</li>
    </ul>
  </li>
  <li><strong>Control Parameters</strong>:
    <ul>
      <li>CLF gain: $c_{clf} = 1.0$</li>
      <li>CBF gain: $\alpha_{cbf} = 1.0$</li>
      <li>Safety buffer: $b = 0.1$</li>
    </ul>
  </li>
</ul>

<h3 id="62-scenario-testing">6.2 Scenario Testing</h3>
<p>We tested the controller in four different scenarios:</p>

<p><strong>Scenario 1: Single Obstacle, Circular Path</strong>
<img src="/projects/safe-robot-arm/Figures/Scenario_1__Single_Obstacle__Circle_Path.gif" alt="Scenario 1" /></p>
<ul>
  <li>One obstacle placed near the path</li>
  <li>End-effector tracks a circular trajectory</li>
  <li>Successful obstacle avoidance and path tracking</li>
  <li>Quantitative Results:
    <ul>
      <li>Mean tracking error: 0.1450 m</li>
      <li>Max tracking error: 0.3007 m</li>
      <li>Min distance to obstacle: 0.0000 m</li>
      <li>Number of safety margin violations: 0</li>
    </ul>
  </li>
  <li>Tracking Error vs Time:
<img src="/projects/safe-robot-arm/Figures/tracking_error_scenario1.png" alt="Tracking Error Scenario 1" /></li>
</ul>

<p><strong>Scenario 2: Two Obstacles, Elliptical Path</strong>
<img src="/projects/safe-robot-arm/Figures/Scenario_2__Two_Obstacles__Elliptical_Path.gif" alt="Scenario 2" /></p>
<ul>
  <li>Two obstacles at different locations</li>
  <li>End-effector tracks an elliptical trajectory</li>
  <li>Maintains safety margins with slight tracking error near obstacles</li>
  <li>Quantitative Results:
    <ul>
      <li>Mean tracking error: 0.1760 m</li>
      <li>Max tracking error: 0.6138 m</li>
      <li>Min distance to obstacle: 0.0000 m</li>
      <li>Number of safety margin violations: 0</li>
    </ul>
  </li>
  <li>Tracking Error vs Time:
<img src="/projects/safe-robot-arm/Figures/tracking_error_scenario2.png" alt="Tracking Error Scenario 2" /></li>
</ul>

<p><strong>Scenario 3: Three Obstacles, Figure-Eight Path</strong>
<img src="/projects/safe-robot-arm/Figures/Scenario_3__Three_Obstacles__Figure_8_Path.gif" alt="Scenario 3" /></p>
<ul>
  <li>Three obstacles in the workspace</li>
  <li>End-effector follows a figure-eight trajectory</li>
  <li>Successfully avoids all obstacles with increased tracking error near multiple obstacles</li>
  <li>Quantitative Results:
    <ul>
      <li>Mean tracking error: 0.1083 m</li>
      <li>Max tracking error: 0.2365 m</li>
      <li>Min distance to obstacle: 0.0000 m</li>
      <li>Number of safety margin violations: 0</li>
    </ul>
  </li>
  <li>Tracking Error vs Time:
<img src="/projects/safe-robot-arm/Figures/tracking_error_scenario3.png" alt="Tracking Error Scenario 3" /></li>
</ul>

<p><strong>Scenario 4: Dense Obstacles, Fast Path (Failure Case)</strong>
<img src="/projects/safe-robot-arm/Figures/Scenario_4__Dense_Obstacles__Fast_Path.gif" alt="Scenario 4" /></p>
<ul>
  <li>Setup: Four obstacles, including one at the center ([0.0, 0.0]); the end-effector attempts to track a fast circular trajectory ($\omega = 1.2$).</li>
  <li>Main Cause of Failure:
    <ul>
      <li><strong>High Path Velocity ($\omega = 1.2$):</strong> The desired trajectory changes rapidly. The CLF tries to aggressively drive the state toward this fast-changing target, but due to joint velocity limits, the arm cannot always keep up. When the end-effector falls behind, the CLF attempts to catch up, but the CBF (safety) constraint prevents it from taking a shortcut through the obstacle’s safety margin. The only feasible solution is to “bounce back” or reverse, even if there is open space elsewhere.</li>
      <li><strong>CBF Constraint as a Hard Wall:</strong> The CBF acts as a strict safety barrier. Even when the obstacles are not tightly packed around the end-effector, the robot cannot “cut through” the safety margin to catch up with the fast-moving target. This results in the observed bounce-back or stalling effect.</li>
      <li><strong>QP Solver Feasibility:</strong> The clf_cbf_qp() function includes a relaxation variable (delta), but the cost on it is high (relax_penalty = 1e2). When constraints are too tight, the solver may choose suboptimal or zero control inputs ($u = [0, 0]$), or fall back to minimal motion to satisfy safety, which looks like bouncing or jittering in the animation.</li>
      <li><strong>Check:</strong> Printing prob.status or delta.value can help confirm when relaxation is being heavily used or when the QP is infeasible.</li>
    </ul>
  </li>
  <li><strong>Observation:</strong> The controller cannot track the entire path. The end-effector “bounces back” from safety margins and only covers a portion of the desired trajectory. Safety is always maintained, but tracking is sacrificed due to these physical and algorithmic limitations. Notably, the bounce-back is primarily due to high path velocity and velocity limits, not because the obstacles are tightly packed around the end-effector.</li>
  <li><strong>Insights:</strong>
    <ul>
      <li>The controller is robust to moderate obstacle density and path complexity, maintaining safety and reasonable tracking.</li>
      <li>In highly cluttered or high-speed scenarios, the controller prioritizes safety, resulting in incomplete or distorted path following and “bounce back” behavior at safety margins.</li>
      <li>These tests highlight the trade-off between tracking performance and safety, and the importance of feasible trajectory planning in dense environments.</li>
    </ul>
  </li>
  <li>Quantitative Results:
    <ul>
      <li>Mean tracking error: 0.6765 m</li>
      <li>Max tracking error: 2.0384 m</li>
      <li>Min distance to obstacle: 0.0000 m</li>
      <li>Number of safety margin violations: 0</li>
    </ul>
  </li>
  <li>Tracking Error vs Time:
<img src="/projects/safe-robot-arm/Figures/tracking_error_scenario4.png" alt="Tracking Error Scenario 4" /></li>
</ul>

<h3 id="63-discussion">6.3 Discussion</h3>
<ul>
  <li><strong>Trade-offs</strong>: Performance vs. safety</li>
  <li><strong>Limitations</strong>: Current implementation constraints</li>
  <li><strong>Advantages</strong>: Real-time capability, safety guarantees</li>
</ul>

<h2 id="7-conclusion-and-future-work">7. Conclusion and Future Work</h2>
<h3 id="71-key-contributions">7.1 Key Contributions</h3>
<ul>
  <li>Implementation of CLF-CBF QP for 2-DOF robot</li>
  <li>Real-time safe control</li>
  <li>Experimental validation</li>
</ul>

<h3 id="72-future-work">7.2 Future Work</h3>
<ol>
  <li><strong>Extensions</strong>:
    <ul>
      <li>Dynamic obstacles</li>
      <li>Multiple robots</li>
      <li>Higher DOF systems</li>
    </ul>
  </li>
  <li><strong>Improvements</strong>:
    <ul>
      <li>Adaptive gains</li>
      <li>Learning-based parameter tuning</li>
      <li>Hardware implementation</li>
    </ul>
  </li>
  <li><strong>Applications</strong>:
    <ul>
      <li>Human-robot collaboration</li>
      <li>Autonomous navigation</li>
      <li>Medical robotics</li>
    </ul>
  </li>
</ol>

<h2 id="8-references">8. References</h2>

<p>[1] High-Order Control Barrier Functions, IEEE Transactions on Automatic Control, Vol. 67, No. 7, 2022</p>

<p>[2] Course Lecture Notes – ME548</p>

<p>[3] Python (NumPy, SciPy, cvxpy, Matplotlib)</p>

<p>[4] CVXPY &amp; OSQP documentation</p>

<p>[5] OpenAI. (2024). ChatGPT (GPT-4)</p>

<h2 id="9-additional-figures">9. Additional Figures</h2>
<p><img src="/projects/safe-robot-arm/Figures/Figure_1.png" alt="Figure 1" />
<img src="/projects/safe-robot-arm/Figures/Figure_2.png" alt="Figure 2" />
<img src="/projects/safe-robot-arm/Figures/Figure_3.png" alt="Figure 3" />
<img src="/projects/safe-robot-arm/Figures/Figure_4.png" alt="Figure 4" /></p>

<p><strong>Tracking Error vs Time Plots:</strong></p>

<ul>
  <li>Scenario 1: Single Obstacle, Circular Path<br />
<img src="/projects/safe-robot-arm/Figures/scenario1.png" alt="Tracking Error Scenario 1" /></li>
  <li>Scenario 2: Two Obstacles, Elliptical Path<br />
<img src="/projects/safe-robot-arm/Figures/tracking_error_scenario2.png" alt="Tracking Error Scenario 2" /></li>
  <li>Scenario 3: Three Obstacles, Figure-Eight Path<br />
<img src="/projects/safe-robot-arm/Figures/tracking_error_scenario3.png" alt="Tracking Error Scenario 3" /></li>
  <li>Scenario 4: Dense Obstacles, Fast Path<br />
<img src="/projects/safe-robot-arm/Figures/tracking_error_scenario4.png" alt="Tracking Error Scenario 4" /></li>
</ul>

    </div>
</div>

<!-- MathJax for LaTeX math rendering -->
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

</div>

     
</body>

<script>
const toggleSwitches = document.querySelectorAll('#theme-toggle, #theme-toggle-mobile');

if (toggleSwitches.length) {
    if (!localStorage.getItem('theme')) {
        localStorage.setItem('theme', 'dark');
    }

    if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-theme');
        toggleSwitches.forEach(t => t.checked = true);
    } else {
        document.body.classList.remove('dark-theme');
        toggleSwitches.forEach(t => t.checked = false);
    }

    toggleSwitches.forEach(toggleSwitch => {
        toggleSwitch.addEventListener('change', () => {
            if (toggleSwitch.checked) {
                document.body.classList.add('dark-theme');
                localStorage.setItem('theme', 'dark');
            } else {
                document.body.classList.remove('dark-theme');
                localStorage.setItem('theme', 'light');
            }
            // Sync both toggles
            toggleSwitches.forEach(t => t.checked = toggleSwitch.checked);
        });
    });
}
</script>


    <footer>
    <div class="footer-content">
        <div class="links">
            <a href="/">
                <span>Home</span>
            </a>
            <a href="/about.html">
                <span>About</span>
            </a>
            <a href="/experience/">
                <span>Experience</span>
            </a>
            <a href="/projects/">
                <span>Projects</span>
            </a>
            <a href="/assets/resume/SudarsanSrinivasan_Resume.pdf" target="_blank" rel="noopener noreferrer">
                <span>Resume</span>
            </a>
        </div>
    </div>
    <div class="license">
        <span>
            For any questions or suggestions about my portfolio, feel free to 
            <a class="help" href="mailto:sudsrini@uw.edu">email me here</a>.
        </span>
        <p>
            © 2025 Sudarsan Srinivasan. Built using the FreeToEngineer portfolio template, 
            licensed under <a href="https://creativecommons.org/licenses/by/4.0/?ref=chooser-v1" target="_blank">CC BY 4.0</a>.
        </p>
    </div>
</footer>

</html>